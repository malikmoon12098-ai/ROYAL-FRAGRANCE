<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Royal Fragrance</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .checkout-container {
            padding: 120px 0 80px;
            max-width: 800px;
            margin: 0 auto;
        }

        .checkout-form {
            background: var(--color-dark-gray);
            padding: 40px;
            border: 1px solid #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-gold);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: #111;
            border: 1px solid #333;
            color: white;
            font-family: var(--font-body);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-gold);
        }

        .order-summary {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .success-message i {
            font-size: 4rem;
            color: var(--color-gold);
            margin-bottom: 20px;
        }

        /* Navbar Duplicate */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            padding: 20px 0;
            z-index: 1000;
            border-bottom: 1px solid #333;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-gold);
            letter-spacing: 2px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
            color: #fff;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <nav>
        <div class="container nav-container">
            <a href="index.html" class="logo">ROYAL FRAGRANCE</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
            </ul>
        </div>
    </nav>

    <div class="container checkout-container">

        <div id="checkout-view">
            <h1 class="text-center" style="margin-bottom: 40px;">Secure Checkout</h1>

            <form id="checkout-form" class="checkout-form" onsubmit="handleCheckout(event)">
                <h3 style="margin-bottom: 20px;">Shipping Details</h3>

                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" class="form-control" name="name" required>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control" name="email" required>
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" class="form-control" name="phone" required>
                </div>

                <div class="form-group">
                    <label>Shipping Address</label>
                    <textarea class="form-control" name="address" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label>City</label>
                    <input type="text" class="form-control" name="city" required>
                </div>

                <div class="order-summary">
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size: 1.2rem;">
                        <span>Total Amount (COD)</span>
                        <span id="total-amount" class="text-gold">$0</span>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width:100%; margin-top: 20px;">Place Order (Cash on
                    Delivery)</button>
            </form>
        </div>

        <div id="success-view" class="success-message fade-in">
            <i class="fas fa-check-circle"></i>
            <h1>Order Placed Successfully!</h1>
            <p style="margin-bottom: 30px;">Thank you for your purchase. Your order ID is <span id="order-id"
                    class="text-gold"></span></p>
            <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
        </div>

    </div>

    <script src="js/data.js"></script>
    <script>
        let cartTotal = 0;

        document.addEventListener('DOMContentLoaded', () => {
            const cart = JSON.parse(localStorage.getItem('rf_cart') || '[]');
            if (cart.length === 0) {
                window.location.href = 'shop.html';
                return;
            }

            cart.forEach(item => {
                const p = DataManager.getProductById(item.productId);
                if (p) cartTotal += p.price * item.quantity;
            });

            document.getElementById('total-amount').textContent = '$' + cartTotal;
        });

        function handleCheckout(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const cart = JSON.parse(localStorage.getItem('rf_cart') || '[]');

            const order = {
                customer: {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    city: formData.get('city')
                },
                items: cart,
                total: cartTotal,
                paymentMethod: 'COD'
            };

            const savedOrder = DataManager.saveOrder(order);

            // Clear Cart
            localStorage.setItem('rf_cart', JSON.stringify([]));

            // Show Success
            document.getElementById('checkout-view').style.display = 'none';
            document.getElementById('success-view').style.display = 'block';
            document.getElementById('order-id').textContent = savedOrder.id;
        }
    </script>
</body>

</html>